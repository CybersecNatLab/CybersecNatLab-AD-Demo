import sys
from typing import Optional

import bs4
import requests

team_id = sys.argv[1]
service_addr = f"10.60.{team_id}.1"


def view_note(note_id: int) -> Optional[tuple[str, str]]:
    resp = requests.get(f'http://{service_addr}:8080/view/{note_id}')
    if resp.status_code == 404:
        return None

    resp.raise_for_status()

    html = bs4.BeautifulSoup(resp.text, features='html.parser')
    title_elem = html.select_one('div.container > h1')
    content_elem = html.select_one('div.container > p')
    assert title_elem and content_elem

    return title_elem.text.strip(), content_elem.text.strip()


def create_note(title: str, content: str, private: bool) -> int:
    note_data = {}
    note_data['title'] = title
    note_data['content'] = content
    if private:
        note_data['private'] = ''

    resp = requests.post(f'http://{service_addr}:8080/new', data=note_data)
    resp.raise_for_status()

    parts = resp.url.split('/view/')
    assert len(parts) == 2

    return int(parts[1])
